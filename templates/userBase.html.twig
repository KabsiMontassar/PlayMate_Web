<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>



<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
  <link href="{{ asset('Back/assets/vendor/bootstrap/css/bootstrap.min.css') }}" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css">

<link rel="stylesheet" href="{{ asset('Front/css/userprofile.css') }}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="{{ asset('bundles/mercuryseriesflashy/css/flashy.css') }}">


</head>
<body>
<div id="fb-root"></div>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/fr_FR/sdk.js#xfbml=1&version=v11.0" nonce="{{ nonce }}"></script>
  <div class="quarter-circle">    <a href="{{ path('app_Home' ) }}" ><img class="logo" style="height:90px" src="{{ asset('Back/assets/img/PlayMate.png') }}"></a>
</div>

   

    <input class="menu-icon" type="checkbox" id="menu-icon" name="menu-icon"/>
    <label for="menu-icon"></label>
    <nav class="navbox"> 		
        <ul class="pt-5"  id="listelements">
        </ul>
    </nav>

<main id="main">

</main>
<div class="bg"></div>
<div class="bg bg2"></div>
<div class="bg bg3"></div>
 <script src="{{ asset('bundles/mercuryseriesflashy/js/flashy.js') }}"></script>
 <script src="//code.jquery.com/jquery.js"></script>
    <!-- Load Flashy default JavaScript -->
    <div class="flashy" data-flashy-position="bottom" data-flashy-duration="5000"></div>

   
    <!-- Include Flashy default partial -->
    
     {{ include('@MercurySeriesFlashy/flashy.html.twig') }}
     </div>
     
   
   
<script>
  var Membreelemnts = ` 
<div class="container" id="overview"  style="display:block;">
    {{ include('Front/ProfileElements/userProfile.html.twig' ) }}
       
</div>
<div class="container" id="equipe" style="display:none;" >
    {{ include('Front/ProfileElements/userEquipe.html.twig' ) }}
</div>
<div class="container" id="reservation" style="display:none;">
    {{include('Front/ProfileElements/userReservation.html.twig')}}
</div>

<div class="container" id="participation" style="display:none;">
    {{include('Front/ProfileElements/userParticipation.html.twig')}}
</div>

<div class="container" id="commande" style="display:none;">
    {{include('Front/ProfileElements/userCommande.html.twig')}}
</div>
  `
  var Organisateur = `<div class="container" id="overview" >
    {{include('Front/ProfileElements/userProfile.html.twig')}}
</div>
<div class="container" id="participation" style="display:none;">
    {{include('Front/ProfileElements/userParticipation.html.twig')}}
</div>

<div class="container" id="tournoi" style="display:none;">
   {{ include('Front/ProfileElements/userTournoi.html.twig') }}


</div>
  `

var Proprietaire = `<div class="container" id="overview" >
    {{include('Front/ProfileElements/userProfile.html.twig')}}
</div>

<div class="container" id="reservation" style="display:none;">
    {{include('Front/ProfileElements/userReservation.html.twig')}}
</div>

<div class="container" id="terrain" style="display:none;">
    {{include('Front/ProfileElements/userTerrain.html.twig')}}
</div>

<div class="container" id="avis" style="display:none;">
    {{include('Front/ProfileElements/userAvis.html.twig')}}
</div>
`

var Fournisseur = `
<div class="container" id="overview" >
    {{include('Front/ProfileElements/userProfile.html.twig')}}
 
</div>
<div class="container" id="commande" style="display:none;">
    {{include('Front/ProfileElements/userCommande.html.twig')}}
</div>

<div class="container" id="produit" style="display:none;">
    {{include('Front/ProfileElements/userProduit.html.twig')}}
</div>
`
var MembreListelements = `
  <li><a href="#overview" onclick="out('overview')" class="active">Profile</a></li>
            <li><a href="#reservation" onclick="out('reservation')">Reservation</a></li>
            <li><a href="#participation" onclick="out('participation')">Participation</a></li>
            <li><a href="#commande" onclick="out('commande')">Commande</a></li>
            <li><a href="#equipe" onclick="out('equipe')">Equipe</a></li>
  `
  var OrganisateurListelements = `
  <li><a href="#overview" onclick="out('overview')" class="active">Profile</a></li>
            <li><a href="#participation" onclick="out('participation')">Participation</a></li>
            <li><a href="#tournoi" onclick="out('tournoi')">Tournoi</a></li>
  `
  var ProprietaireListelements = `
  <li><a href="#overview" onclick="out('overview')" class="active">Profile</a></li>
            <li><a href="#reservation" onclick="out('reservation')">Reservation</a></li>
            <li><a href="#terrain" onclick="out('terrain')">Terrain</a></li>
            <li><a href="#avis" onclick="out('avis')">Avis</a></li>

  `
  var FournisseurListelements = `
  <li><a href="#overview" onclick="out('overview')" class="active">Profile</a></li>
            <li><a href="#commande" onclick="out('commande')">Commande</a></li>
            <li><a href="#produit" onclick="out('produit')">Produit</a></li>
  `
  
  function changeMainContent() {
            var mainContent = document.getElementById('main');
            var listelements = document.getElementById('listelements');
            var role = '{{ app.user.role }}'; // Fetch the user role from Twig

            if (role === 'Membre') {
                listelements.innerHTML = MembreListelements; // Change the content for Membre
                mainContent.innerHTML = Membreelemnts; // Change the content for Membre
            } else if (role === 'Organisateur') {
                listelements.innerHTML = OrganisateurListelements; // Change the content for Organisateur
                mainContent.innerHTML = Organisateur; // Change the content for Organisateur
            } else if (role === 'Fournisseur') {
                listelements.innerHTML = FournisseurListelements; // Change the content for Fournisseur
                mainContent.innerHTML = Fournisseur; // Change the content for Fournisseur
            } else {
                listelements.innerHTML = ProprietaireListelements; // Change the content for Proprietaire
                mainContent.innerHTML = Proprietaire; // Change the content for Proprietaire
            }

            
        }

        // Call the function when the DOM content is fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            changeMainContent();
    
 
        });

{% for message in app.flashes('success') %}
    <div class="alert alert-success">
        {{ message }}
    </div>
{% endfor %}


  function out(id){
    var elements = document.getElementsByClassName('container');
    for (var i = 0; i < elements.length; i++) {
      elements[i].style.display = 'none';
    }
    document.getElementById(id).style.display = 'block';

    document.getElementById('menu-icon').checked = false;

  }


function invertStatus(userEmail) {
  const confirmDeactivationBtn = document.getElementById('confirmDeactivationBtn');
 
  $.post("/user/inverStatus/" + userEmail , function(data) {
        if (data === 'success') {
            window.location.href = '/logout';
        } else {
            console.log('error');
         } 
    });
}
  
 
</script>
 <script src="{{ asset('Back/assets/vendor/bootstrap/js/bootstrap.bundle.min.js') }}"></script>
 <script>
function shareOnFacebook(url) {
    FB.ui({
        method: 'share',
        href: url,
    }, function(response){});
}
</script>

 <!-- Charger la bibliothèque xlsx -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
<script> function convertToExcel() {
    // Données à exporter en Excel
    const data = [];
    {% for terrain in terrains %}
        data.push({ Nom: "{{ terrain.nomterrain }}", Adresse: "{{ terrain.address }}" });
    {% endfor %}

    // Créer un nouveau classeur Excel
    const wb = XLSX.utils.book_new();
    // Ajouter une feuille de calcul au classeur
    const ws = XLSX.utils.json_to_sheet(data);

    // Personnalisation du style de la feuille de calcul
    ws["A1"].s = { bold: true, alignment: { horizontal: "center" }, font: { color: { rgb: "FFADD8E6" } } }; // Style pour la colonne Nom
    ws["B1"].s = { bold: true, alignment: { horizontal: "center" }, font: { color: { rgb: "FF000080" } } }; // Style pour la colonne Adresse

    // Générer un nom de fichier unique
    const fileName = 'terrains_' + new Date().getTime() + '.xlsx';

    // Ajouter la feuille de calcul au classeur
    XLSX.utils.book_append_sheet(wb, ws, 'Terrains');

    // Générer le fichier Excel et le télécharger
    XLSX.writeFile(wb, fileName);
}


</script>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
 
<script>
  // Attendre que le contenu du DOM soit chargé avant d'exécuter le script
  document.addEventListener('DOMContentLoaded', function() {
    // Pour chaque tournoi, initialiser un graphique
    {% for tournoi in tournois %}
      var ctx = document.getElementById('chart-tournoi-{{ tournoi.id }}').getContext('2d');
      var chart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['Visites', 'Participations'],
          datasets: [{
            label: 'Statistiques',
            data: [
              {{ tournoi.getVisite }},
              {{ participationsById[tournoi.id] | default(0) }}
            ],
            backgroundColor: ['rgba(0, 123, 255, 0.5)', 'rgba(40, 167, 69, 0.5)'],
            borderColor: ['rgba(0, 123, 255, 1)', 'rgba(40, 167, 69, 1)'],
            borderWidth: 1
          }]
        },
        options: {
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    {% endfor %}
    var ctx1 = document.getElementById('myChart').getContext('2d');
    var myChart1 = new Chart(ctx1, {
        type: 'bar',
        data: {
            labels: [
                {% for terrain in terrains %}
                    "{{ terrain.nomterrain }}",
                {% endfor %}
            ],
            datasets: [{
                label: 'Nombre d\'avis par terrain',
                data: [
                    {% for terrain in terrains %}
                        {{ avisCounts[terrain.id] ?? 0 }},
                    {% endfor %}
                ],
               backgroundColor: [
    'rgba(169, 169, 169, 0.2)', // Gris
    'rgba(169, 169, 169, 0.2)',
    'rgba(169, 169, 169, 0.2)',
    'rgba(169, 169, 169, 0.2)',
    'rgba(169, 169, 169, 0.2)',
    'rgba(169, 169, 169, 0.2)'
],
borderColor: [
    'rgba(169, 169, 169, 1)', // Gris
    'rgba(169, 169, 169, 1)',
    'rgba(169, 169, 169, 1)',
    'rgba(169, 169, 169, 1)',
    'rgba(169, 169, 169, 1)',
    'rgba(169, 169, 169, 1)'
],
                borderWidth: 1
            }]
        },
        options: {
    scales: {
        y: {
            min: 0, // Valeur minimale de l'axe Y
            suggestedMax: 10, // Valeur maximale suggérée de l'axe Y
            precision: 0, // Pas de décimales pour les étiquettes de l'axe Y
            ticks: {
                stepSize: 1 // Incrémentation de l'axe Y
            }
        }
    }
}

        
    });
  });
</script>


</body>
</html>
